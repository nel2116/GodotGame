---
title: 技術詳細設計書
version: 0.1.0
status: draft
updated: 2024-06-07
tags:
    - TechnicalDesign
    - Godot
    - GameDev
    - Reference
linked_docs:
    - "[[AI_Agent_GameDesignFlow.md|AIエージェント活用型ゲーム設計フロー]]"
    - "[[14.1_Requirement.md|技術要件定義]]"
    - "[[11_1_plan.md|プロジェクト計画書]]"
    - "[[14.2_PrototypeTechnicalDesign.md|プロトタイプ技術設計]]"
---

# 目次

1. [概要](#概要)
2. [詳細](#詳細)
    1. [要件定義](#要件定義)
    2. [基本設計](#基本設計)
    3. [詳細設計](#詳細設計)
3. [使用方法](#使用方法)
4. [制限事項](#制限事項)
5. [変更履歴](#変更履歴)

# 概要

本ドキュメントは、AIエージェント活用型ゲーム設計フローおよびドキュメント管理ルールに基づき、Godot 4.x（C#）によるHD 2Dローグライクアクションゲームの技術詳細設計をまとめたものである。
要件定義・基本設計・詳細設計の3層構造で記述し、各種コアドキュメントとのトレーサビリティを確保する。

# 詳細

## 1. 要件定義

- **開発形態**：個人開発（Godot 4.2 LTS／C#）
- **ジャンル**：HD 2Dローグライクアクション
- **目的**：MVPで「瞬発的アクション」と「ビルド多様性」の面白さを検証し、Steam体験版公開可否を判断
- **ターゲット**：コアゲーマー（18–35歳、ローグライク・メトロイドヴァニア好き）
- **KPI**：入力→ヒット遅延≤100ms、主要ビルド2種体験（3ラン以内）、60fps固定、死亡→再挑戦≤10秒
- **スコープ（MVP）**：3部屋＋1ボス、近接/遠距離2系統ビルド、プレースホルダアート、Windows対応
- **機能要件**：プレイヤー基本アクション、敵AI基礎、アイテム取得＆ビルド変化、ボス戦、チュートリアル部屋、コントローラ設定UI、実績システム
- **非機能要件**：FPS60、ロード≤5秒、GTX970/8GB以上、英語/日本語UI、アクセシビリティ

## 2. 基本設計

- **コアループ**：巡礼開始→探索＆戦闘→ボス撃破→帰還＆永続アップグレード→再出発
- **技術スタック**：
    - Godot 4.x（C#/.NET）
    - Reactive Programming（System.Reactive）
    - TileMap＋NavigationServer：部屋生成＆AIパス
    - Resourceデータ駆動：スキル・聖遺物
    - StateMachine/AnimationTree：アクション遷移
    - Signalベースイベントバス：UI・スキルツリー更新
    - JSON保存＋暗号化：メタ進行・コレクション情報
- **システム構成**：
    - 入力管理：InputイベントをObservable化し、FiniteStateMachineで状態遷移
    - ダンジョン生成：部屋テンプレートResource＋乱数シードで自動生成
    - 敵AI：状態遷移とシグナル駆動、距離・視線イベントで行動決定
    - 戦闘システム：HitBox/HurtBoxの信号連携、StatSystemでダメージ計算
    - スキル管理：SkillResource＋クールダウン管理、UIと連動
    - セーブデータ：SaveRequest Subjectで非同期保存、FileAccess完了をObservable化
    - UI：Controlノード＋カスタムテーマ、データ変更をObservableで監視
    - テスト自動化：GUT＋リプレイ解析、CIで自動テスト＆KPI計測
    - パフォーマンス計測：ProfilerAPIで統計をObservable化、CSV出力

## 3. 詳細設計

### 3.1 プレイヤーアクション
- 入力バッファ：InputRing[12]で保持、硬直中も次行動予約
- アクションフレーム表：通常攻撃L1（20F）、L2（22F）、チャージ攻撃（40F）、回避ロール（26F）、ジャンプ（30F）
- キャンセル表：各アクションのキャンセル可能フレーム・遷移先を明示
- 優先度：回避＞ジャンプ＞攻撃

### 3.2 敵AI
- 行動ステート：Observableで管理、条件変化で自動遷移
- センサー：距離・視線・被弾などをSignalで取得
- AIユニット管理：CompositeDisposableで一括解放

### 3.3 戦闘・ダメージ
- 攻撃判定：EmitHitでIObservable<HitInfo>生成
- ダメージ計算：StatSystemでリアルタイム更新
- ヒットストップ・演出：事象ごとに停止F/カメラ/パーティクル/SEを定義
- スタガーシステム：Poise値・スタガーダメージ・スタガー時間・追加効果

### 3.4 スキル・ビルド
- SkillResource：属性・クールダウン・発動条件をデータ化
- クールダウン管理：TimerイベントをObservable化
- スキルツリー：ジョブごと分岐型、条件解放ノードあり
- ルーンカスタマイズ：形状・属性・トリガーを改変

### 3.5 ダンジョン生成
- 部屋テンプレート：Resource化し再利用
- 乱数シード：Subjectで管理、生成過程をObservableでデバッグ
- NavigationRegion：生成後に再計算

### 3.6 セーブ・ロード
- SaveManager：RequestSaveで非同期保存、完了時にUI通知
- JSON形式：進行・コレクション情報を保存、暗号化対応

### 3.7 UI/UX
- カスタムテーマ：Resourceで定義、UIBuilderで再利用性確保
- データバインディング：Observableで自動更新
- 画面遷移：SceneTree.change_scene_to_fileを反応的にトリガ

### 3.8 テスト・パフォーマンス
- GUT：30件以上のユニットテスト
- Autotest.gd：KPI（fps, hit_delay, room_time）をCSV出力
- Profiler：EngineProfiler.enable()で統計取得、閾値超過時に警告

# 使用方法

- 本設計書を参照し、各システム・機能の実装指針とする
- 実装時は関連md（Docs/10_CoreDocs/14_TechDocs配下）も必ず参照
- 仕様変更時は本書および関連ドキュメントのメタデータ・変更履歴を更新

# 制限事項

- 本設計はMVPスコープを前提とする
- Godot 4.x LTSの安定性・外部パッケージ依存に注意
- 仕様追加・変更時は必ずドキュメント管理ルールに従い更新

# 変更履歴

| バージョン | 更新日     | 変更内容                |
| ---------- | ---------- | ----------------------- |
| 0.1.0      | 2024-06-07 | 初版作成（AI自動生成）  |
